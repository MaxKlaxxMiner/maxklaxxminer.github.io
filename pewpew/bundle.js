(()=>{"use strict";var t={660:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.initEvents=e.userFirstInteract=e.mouse=e.keys=void 0;const i=s(295),r=s(268);e.keys={},e.mouse={x:0,y:0,buttons:0,wheel:0},e.userFirstInteract=!1,e.initEvents=function(t){function s(t){void 0===t.wheelDelta?"number"==typeof t.deltaY?t.deltaY>0?e.mouse.wheel++:e.mouse.wheel--:t.detail>0?e.mouse.wheel++:e.mouse.wheel--:t.wheelDelta<0?e.mouse.wheel++:e.mouse.wheel--}document.body.onkeydown=t=>{r.Keys[t.keyCode]||console.log("key pressed: "+t.keyCode+(r.Keys[t.keyCode]?" (Keys."+r.Keys[t.keyCode]+")":"")),e.keys[t.keyCode]=!0,e.userFirstInteract=!0},document.body.onkeyup=t=>{e.keys[t.keyCode]=!1},document.addEventListener("contextmenu",(t=>t.preventDefault())),"onmousewheel"in window?window.onmousewheel=s:document.addEventListener("DOMMouseScroll",s,!1);const o=t=>{e.mouse.x=t.x,e.mouse.y=t.y,e.mouse.buttons=t.buttons},a=document.getElementsByTagName("canvas")[0];a.onmousedown=o,a.onmousemove=o,a.onmouseup=o,document.body.onmousedown=()=>{e.userFirstInteract=!0},window.onresize=()=>{t.resize(i.Tools.getWindowSize())}}},511:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;const i=s(692),r=s(887),o=s(371),a=s(295),h=s(864),n=s(366),l=s(694),c=s(660),d=s(268),u=s(538),m=s(198),p=s(791),y=s(369);class g{static init(){const t=document.createElement("canvas");this.viewport=new i.Viewport(t,a.Tools.getWindowSize()),document.body.insertBefore(t,document.body.childNodes[0]),(0,c.initEvents)(this.viewport),a.Tools.downloadText("build.js",((t,e)=>{this.versionHash=a.Tools.hashCode(e)})),h.Images.init((()=>{n.Sprites.init(),this.player=new r.Player({x:0,y:0,a:0},n.Sprites.spaceship,5);for(let t=0;t<1e3;t++){const t={x:2e4*Math.random()-1e4,y:2e4*Math.random()-1e4,a:0},e=12*Math.random()>>0,s=8*Math.random()>>0,i=Math.random()*(s%4+3)+3,r=new o.Asteroid(t,n.Sprites.roids[s+12*e],i);r.mx=.06*(Math.random()-.5),r.my=.06*(Math.random()-.5),r.ma=.0012*(Math.random()-.5),this.roids.push(r)}}))}static main(){let t=l.Controls.None;if(c.keys[d.Keys.Space]&&(t|=l.Controls.Fire),c.keys[d.Keys.A]&&(t|=l.Controls.Left),c.keys[d.Keys.D]&&(t|=l.Controls.Right),c.keys[d.Keys.W]&&(t|=l.Controls.Accelerate),c.keys[d.Keys.S]&&(t|=l.Controls.Brake),c.keys[d.Keys.Shift]&&(t|=l.Controls.Boost),0!=(1&c.mouse.buttons)){t|=l.Controls.Fire;const e=u.Vec.getHeadingAngle({x:.5*this.viewport.w,y:.5*this.viewport.h},c.mouse);t|=u.Vec.getSteerToAngle(this.player,e)}if(c.keys[d.Keys.C]&&(t|=l.Controls.FireRocket,c.keys[d.Keys.C]=!1),c.keys[d.Keys.Q]){const t=new m.EnemyCopycat(this.player,n.Sprites.spaceship,3,this.log.length,150*this.copycatCount+++500);this.enemies.push(t),c.keys[d.Keys.Q]=!1}if(c.keys[d.Keys.E]){const t=new p.EnemyChaser(this.player,n.Sprites.redSpaceship,6,100*this.chaserCount+++200);this.enemies.push(t),c.keys[d.Keys.E]=!1}c.keys[d.Keys.F8]&&(this.viewport.retina=!this.viewport.retina,c.keys[d.Keys.F8]=!1),c.keys[d.Keys.F9]&&(this.maxFps=!this.maxFps,c.keys[d.Keys.F9]=!1);let e=!1;t&l.Controls.Fire&&(e=this.player.fireLaser());let s=!1;t&l.Controls.FireRocket&&(s=this.player.fireRocket()),this.player.control(t),c.keys[d.Keys.Shift]||(this.player.mx*=.9997,this.player.my*=.9997),this.player.update(),e&&s?this.log.push({x:this.player.x,y:this.player.y,a:this.player.a,f:!0,r:!0}):e&&!s?this.log.push({x:this.player.x,y:this.player.y,a:this.player.a,f:!0}):!e&&s?this.log.push({x:this.player.x,y:this.player.y,a:this.player.a,r:!0}):this.log.push({x:this.player.x,y:this.player.y,a:this.player.a}),this.viewport.setPos(this.player);for(let t=0;t<this.lasers.length;t++)this.lasers[t].update(),this.lasers[t].time>5e3&&(this.lasers.splice(t,1),t--);for(let t=0;t<this.rockets.length;t++)this.rockets[t].update(),this.rockets[t].time>5e3&&(this.rockets.splice(t,1),t--);for(let t=0;t<this.enemies.length;t++)this.enemies[t].update();for(let t=0;t<this.roids.length;t++)this.roids[t].update()}static renderScreen(){const t=this.viewport;y.StarBackground.drawAutoBackground(t,this.player);for(let t=0;t<this.roids.length;t++)this.roids[t].draw(this.viewport);for(let e=0;e<this.enemies.length;e++)this.enemies[e].draw(t);this.player.draw(t);for(let e=0;e<this.lasers.length;e++)this.lasers[e].draw(t);for(let e=0;e<this.rockets.length;e++)this.rockets[e].draw(t);if(this.inMenu){const e=t.ctx;e.font="80px ARIAL",e.strokeStyle="white";let s=e.measureText("PEWPEW");e.strokeText("PEWPEW",this.viewport.w/2-s.width/2,this.viewport.h/3),e.font="30px ARIAL",s=e.measureText("New game");let i=a.Tools.rectFromLabel(this.viewport.w/2-s.width/2,this.viewport.h/1.5,s);e.strokeText("New game",this.viewport.w/2-s.width/2,this.viewport.h/1.5),a.Tools.isInside(c.mouse,i)&&e.strokeRect(i.x-20,i.y+s.actualBoundingBoxAscent/2-5,10,10),0!=(1&c.mouse.buttons)&&a.Tools.isInside(c.mouse,i)&&(this.inMenu=!1),s=e.measureText("Continue"),i=a.Tools.rectFromLabel(this.viewport.w/2-s.width/2,this.viewport.h/1.5+60,s),a.Tools.isInside(c.mouse,i)&&e.strokeRect(i.x-20,i.y+s.actualBoundingBoxAscent/2-5,10,10),e.strokeText("Continue",this.viewport.w/2-s.width/2,this.viewport.h/1.5+60)}}static run(){let t=()=>{if(this.maxFps?setTimeout(t,0):window.requestAnimationFrame(t),this.player)try{const t=Date.now();for(;t>this.time;)this.main(),this.time++;this.renderScreen();const e=Date.now();this.fpsTimes=.01*(99*this.fpsTimes+(e-this.fpsLastTime)),this.fpsLastTime=e,document.title="fps: "+(1e3/this.fpsTimes).toFixed(1)+(0===document.location.host.indexOf("localhost:")?"   v: "+this.versionHash:"")}catch(e){if(0===document.location.host.indexOf("localhost:"))throw t=()=>{},e}};t()}}e.Game=g,g.time=Date.now(),g.maxFps=!1,g.fpsTimes=16,g.fpsLastTime=Date.now(),g.versionHash=0,g.enemies=[],g.copycatCount=0,g.chaserCount=0,g.inMenu=!1,g.lasers=[],g.roids=[],g.rockets=[],g.log=[]},371:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Asteroid=void 0;const i=s(253);class r extends i.Component{constructor(t,e,s,i=100){super(t,[e],s),this.health=i}}e.Asteroid=r},253:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Component=void 0,e.Component=class{constructor(t,e,s=1){this.x=t.x,this.y=t.y,this.a=t.a,this.mx="mx"in t?t.mx:0,this.my="my"in t?t.my:0,this.ma="ma"in t?t.ma:0,this.id=0,this.sprites=e,this.spriteIndex=0,this.scale=s,this.time=0}update(){this.x+=this.mx,this.y+=this.my,this.a+=this.ma,this.time++}draw(t){t.retina?this.sprites[this.spriteIndex].drawRetina(t,this.x,this.y,this.a,this.scale):this.sprites[this.spriteIndex].draw(t,this.x,this.y,this.a,this.scale)}}},694:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.Controls=void 0,function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Accelerate=4]="Accelerate",t[t.Brake=8]="Brake",t[t.Boost=16]="Boost",t[t.Fire=32]="Fire",t[t.StrafeLeft=64]="StrafeLeft",t[t.StrafeRight=128]="StrafeRight",t[t.FireRocket=256]="FireRocket"}(s||(e.Controls=s={}))},964:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Enemy=void 0;const i=s(814);class r extends i.Ship{constructor(t,e,s,i=100){super(t,e,s,i)}fireLaser(){return this.laserCooldown=0,super.fireLaser()}}e.Enemy=r},791:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EnemyChaser=void 0;const i=s(964),r=s(538),o=s(694),a=s(511);class h extends i.Enemy{constructor(t,e,s,i,r=100){super(t,e,s,r),this.middleDistance=i}update(){const t=r.Vec.getPredictedPos(a.Game.player,1e3),e=r.Vec.getPredictedPos(this,2e3);let s=r.Vec.getSteerToAngle(this,r.Vec.getHeadingAngle(e,t));const i=r.Vec.getDistance(e,t);this.time%100==0&&console.log(i.toFixed(2)+" / "+this.middleDistance.toFixed(2)),i>this.middleDistance+25&&(s|=o.Controls.Accelerate),i<this.middleDistance-25&&(s|=o.Controls.Brake),this.control(s),super.update()}}e.EnemyChaser=h},198:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EnemyCopycat=void 0;const i=s(964),r=s(511),o=s(538);class a extends i.Enemy{constructor(t,e,s,i,r,o=100){super(t,e,s,o),this.logStart=r,this.logTime=i}update(){if(this.logStart>0)return void this.logStart--;const t=r.Game.log[this.logTime-1],e=r.Game.log[this.logTime];o.Vec.setPos(this,e),this.mx=e.x-t.x,this.my=e.y-t.y,this.logTime++,e.f&&this.fireLaser()}}e.EnemyCopycat=a},864:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Images=void 0,e.Images=class{static loadAssets(t){this.background=t("bg.png"),this.star=t("star.png"),this.spaceship=t("spaceship3_red.png"),this.laser=t("laser.png"),this.laserAnimation=t("laser_test3.png","s,1, d50,116, 50,50,49,50"),this.redSpaceship=t("red_spaceship.png"),this.roids=t("roids.png","s,16, d,d3, 1,1, 1,1, 2,2, 3,3, 1,1, 1,2, 2,2, 2,3, 1,1, 1,1, 2,2, 2,3"),this.rocket=t("rocket-test-1.png","s,1, 20, 60")}static loadCheck(){let t=0,e=0;const s=[];for(let i=0;i<this.allImages.length;i++)if(e++,this.allImages[i].complete&&0!==this.allImages[i].naturalHeight)t++;else try{s.push(this.allImages[i].src.match(/([^\\/]+)\?/)[1])}catch(t){}return{loaded:t,total:e,todo:s}}static init(t){this.ready=!1;let e="";0===document.location.host.indexOf("localhost:")&&(e="?t="+Date.now()),this.allImages=[],this.loadAssets(((t,s)=>{const i=new Image;return i.src="pewpew/"+t+e,s&&(i.sprites=s),this.allImages.push(i),i}));let s=Date.now();const i=setInterval((()=>{const e=this.loadCheck();Date.now()>s&&(console.log("load assets: "+e.loaded+" / "+e.total+" (todo: "+e.todo.join(", ")+")"),s+=200),e.loaded===e.total&&(clearInterval(i),this.ready=!0,t())}),20)}}},268:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.Keys=void 0,function(t){t[t.Tab=9]="Tab",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Esc=27]="Esc",t[t.Space=32]="Space",t[t.D0=48]="D0",t[t.D1=49]="D1",t[t.D2=50]="D2",t[t.D3=51]="D3",t[t.D4=52]="D4",t[t.D5=53]="D5",t[t.D6=54]="D6",t[t.D7=55]="D7",t[t.D8=56]="D8",t[t.D9=57]="D9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.Num0=96]="Num0",t[t.Num1=97]="Num1",t[t.Num2=98]="Num2",t[t.Num3=99]="Num3",t[t.Num4=100]="Num4",t[t.Num5=101]="Num5",t[t.Num6=102]="Num6",t[t.Num7=103]="Num7",t[t.Num8=104]="Num8",t[t.Num9=105]="Num9",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12"}(s||(e.Keys=s={}))},839:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Laser=void 0;const i=s(306);class r extends i.Projectile{update(){super.update(),!this.isStarted(50)||this.sprites.length<5||(this.spriteIndex=4,this.time<350&&(this.spriteIndex=3),this.time<250&&(this.spriteIndex=2),this.time<150&&(this.spriteIndex=1))}}e.Laser=r},887:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Player=void 0;const i=s(814);class r extends i.Ship{constructor(t,e,s,i=100){super(t,e,s,i)}}e.Player=r},306:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Projectile=void 0;const i=s(253),r=s(538);class o extends i.Component{constructor(t,e,s,i,r,o=1,a=!1){super(t,r,o),this.sourceShip=t,this.offset=e,this.startSpeed=s,this.damage=i,this.sideDrop=a}isStarted(t){return this.time>t||(r.Vec.setPos(this,this.sourceShip),r.Vec.moveRelative(this,this.offset),this.time===t&&(this.sprites.length>1&&(this.spriteIndex=1),this.sideDrop?(r.Vec.updateSpeed(this,this.startSpeed,r.Vec.getAngle({x:this.offset.x,y:0})),r.Vec.updateSpeed(this,.3*this.startSpeed)):r.Vec.updateSpeed(this,this.startSpeed)),!1)}}e.Projectile=o},553:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RandomMersenne=void 0,e.RandomMersenne=class{constructor(t){void 0===t&&(t=Date.now()),this.m=new Array(624),this.n=0,this.init(t)}init(t){this.m[0]=t>>>0;for(let t=1;t<624;t++){const e=this.m[t-1]^this.m[t-1]>>>30;this.m[t]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+t,this.m[t]>>>=0}this.nextBlock()}nextBlock(){let t;for(let e=0;e<227;e++)t=2147483648&this.m[e]|2147483647&this.m[e+1],this.m[e]=this.m[e+397]^t>>>1^2567483615*(1&t);for(let e=227;e<623;e++)t=2147483648&this.m[e]|2147483647&this.m[e+1],this.m[e]=this.m[e-227]^t>>>1^2567483615*(1&t);t=2147483648&this.m[623]|2147483647&this.m[0],this.m[623]=this.m[396]^t>>>1^2567483615*(1&t),this.n=0}nextInt(){let t=this.m[this.n++];return this.n>=624&&this.nextBlock(),t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}next(){return this.nextInt()/4294967296}}},722:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Rocket=void 0;const i=s(306),r=s(538);class o extends i.Projectile{update(){super.update(),!this.isStarted(50)||this.sprites.length<4?this.spriteIndex=0:this.time>=400&&(r.Vec.updateSpeed(this,.001),this.spriteIndex=(this.time-400)%300/100+1>>0)}}e.Rocket=o},814:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Ship=void 0;const i=s(253),r=s(839),o=s(366),a=s(511),h=s(722),n=s(694),l=s(538);class c extends i.Component{constructor(t,e,s,i=100){super(t,[e],s),this.health=i,this.laserCooldown=0,this.laserFireLeft=!1,this.rocketFireLeft=!1,this.rocketAmount=20,this.rocketCooldown=0}fireLaser(){if(this.laserCooldown<=0){const t={x:.47*this.sprites[this.spriteIndex].image.width*this.scale,y:-2.5*this.scale};this.laserFireLeft?(t.x=-t.x,this.laserFireLeft=!1):this.laserFireLeft=!0;const e=new r.Laser(this,t,1,10,o.Sprites.laserAni,.6);return e.ma=0,a.Game.lasers.push(e),this.laserCooldown=500,!0}return!1}fireRocket(){if(this.rocketAmount>0&&this.rocketCooldown<=0){const t={x:.5*this.sprites[this.spriteIndex].image.width*this.scale,y:2.5*this.scale};this.rocketFireLeft?(t.x=-t.x,this.rocketFireLeft=!1):this.rocketFireLeft=!0;const e=new h.Rocket(this,t,.1,30,o.Sprites.rocket,.8,!0);return e.ma=0,a.Game.rockets.push(e),this.rocketAmount--,this.rocketCooldown=200,!0}return!1}control(t){t&n.Controls.Left&&(this.ma-=72e-6),t&n.Controls.Right&&(this.ma+=72e-6),this.ma<0&&(this.ma=Math.min(0,this.ma+36e-6)),this.ma>0&&(this.ma=Math.max(0,this.ma-36e-6)),this.ma<-.006&&(this.ma=-.006),this.ma>.006&&(this.ma=.006),t&n.Controls.Accelerate&&l.Vec.updateSpeed(this,t&n.Controls.Boost?.0018:36e-5),t&n.Controls.Brake&&(this.mx*=.9988,this.my*=.9988,l.Vec.updateSpeed(this,t&n.Controls.Boost?36e-5:11e-5,Math.PI)),t&n.Controls.StrafeLeft&&l.Vec.updateSpeed(this,t&n.Controls.Boost?.0018:36e-5,-.5*Math.PI),t&n.Controls.StrafeRight&&l.Vec.updateSpeed(this,t&n.Controls.Boost?.0018:36e-5,.5*Math.PI)}update(){super.update(),this.laserCooldown--,this.rocketCooldown--}}e.Ship=c},315:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteShape=e.Sprite=void 0;class s{constructor(t){this.image=t,this.ready=0,this.w=0,this.h=0,this.radius=0}static renderMask(t,e,s,i,r){const o=document.createElement("canvas");o.width=i,o.height=r;const a=o.getContext("2d");a.imageSmoothingEnabled=!1,a.imageSmoothingQuality="high",a.drawImage(t,e,s,i,r,0,0,i,r);const h=a.getImageData(0,0,i,r),n=new Uint32Array(i*r+31>>5),l=.5*i,c=.5*r;let d=0;for(let t=0;t<r;t++)for(let e=0;e<i;e++){const s=e+t*i;if(h.data[3+(s<<2)]>224){n[s>>5]|=1<<(31&s);const i=Math.abs(e-l)+1,r=Math.abs(t-c)+1,o=Math.sqrt(i*i+r*r);o>d&&(d=o)}}return{mask:n,radius:d}}static renderRetina(t,e,s,i,r,o){const a=document.createElement("canvas");a.width=i*o,a.height=r*o;const h=a.getContext("2d");h.imageSmoothingEnabled=!1,h.imageSmoothingQuality="high",h.drawImage(t,e,s,i,r,0,0,i*o,r*o);const n=new Image;return n.src=a.toDataURL("image/png"),n}isReady(t){if(this.ready>=t)return!0;const e=this.x?this.x:0,r=this.y?this.y:0;if(this.ready<1){if(!this.image.complete||0===this.image.naturalHeight)return!1;if(this instanceof i||(this.w=this.image.width,this.h=this.image.height),this.radius=Math.sqrt(this.w*this.w+this.h*this.h),this.ready=1,this.ready>=t)return!0}if(this.ready<2){const i=s.renderMask(this.image,e,r,this.w,this.h);if(this.mask=i.mask,this.radius=i.radius,this.ready=2,this.ready>=t)return!0}if(this.ready<3){if(this.retinaImage){if(this.retinaImage.complete&&0!==this.retinaImage.naturalHeight&&(this.ready=3,this.ready>=t))return!0}else this.retinaImage=s.renderRetina(this.image,e,r,this.w,this.h,8);return!1}return!1}draw(t,e,s,i,r){if(!this.isReady(1))return;const o=t.ctx;o.save(),o.translate(e-t.x+.5*t.w,s-t.y+.5*t.h),o.rotate(i),o.drawImage(this.image,-.5*this.w*r,-.5*this.h*r,this.w*r,this.h*r),o.restore()}drawRetina(t,e,s,i,r){if(!this.isReady(3))return;const o=t.ctx;o.save(),t.setSmooth(!0),o.translate(e-t.x+.5*t.w,s-t.y+.5*t.h),o.rotate(i),o.drawImage(this.retinaImage,-.5*this.w*r,-.5*this.h*r,this.w*r,this.h*r),o.restore()}calcCollisionMask(t,e,s,i,r,o,a){if(!this.isReady(2))return;const h=this.mask,n=1/o,l=.5*this.w-.5,c=.5*this.h-.5,d=Math.sin(-r),u=Math.cos(-r),m=new Uint8Array(s);for(let r=e;r<e+i;r++){const e=r*n;for(let i=t;i<t+s;i++){const s=i*n,r=Math.round(u*s-d*e+l),o=Math.round(d*s+u*e+c);if(r>=0&&r<this.w&&o>=0&&o<this.h){const e=r+o*this.w;0!=(h[e>>5]&1<<(31&e))?m[i-t>>>0]=2:m[i-t>>>0]=1}else m[i-t>>>0]=0}a(t,r,m)}}getCollisionMask(t,e,s){if(!this.isReady(2))return new Array(0);const i=new Array(t.h);let r=0;return this.calcCollisionMask(t.x,t.y,t.w,t.h,e,s,((t,e,s)=>{i[r++]=s.slice()})),i}drawPreviewMask(t,e,s,i,r,o,a){for(let h=0;h<i.length;h++){const n=i[h];for(let i=0;i<n.length;){let l=1;for(;i+l<n.length&&n[i+l]===n[i];)l++;t.fillStyle=2===n[i]?r:1===n[i]?o:a,t.fillRect(e+i>>0,s+h>>0,l,1),i+=l}}}previewMask(t,e,s,i,r,o=.5){if(!this.isReady(2))return;t.globalAlpha=o;const a=Math.ceil(this.radius*r),h={x:-a,y:-a,w:2*a,h:2*a},n=this.getCollisionMask(h,i,r);this.drawPreviewMask(t,e+h.x>>0,s+h.y>>0,n,"#fff","#088","#008"),t.globalAlpha=1}previewCutMask(t,e,s,i,r,o,a=.5){if(!this.isReady(2))return;t.globalAlpha=a;const h=this.getCollisionMask(o,i,r);this.drawPreviewMask(t,e+o.x>>0,s+o.y>>0,h,"#f00","#8888","#8888"),t.globalAlpha=1}}e.Sprite=s;class i extends s{constructor(t,e){super(t),this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h}draw(t,e,s,i,r){if(!this.isReady(1))return;const o=t.ctx;o.save(),o.translate(e-t.x+.5*t.w,s-t.y+.5*t.h),o.rotate(i),o.drawImage(this.image,this.x,this.y,this.w,this.h,-.5*this.w*r,-.5*this.h*r,this.w*r,this.h*r),o.restore()}static DecodeShapes(t,e,s){const i=[],r=(t=t.replace(/ /g,"")).split(",");switch(r[0]){case"s":{const t=parseInt(r[1]),o=("d"===r[2]?0:"d"===r[2][0]?-parseInt(r[2].substr(1)):parseInt(r[2]))*t,a=("d"===r[3]?0:"d"===r[3][0]?-parseInt(r[3].substr(1)):parseInt(r[3]))*t,h=[];for(let e=4;e<r.length;e++)h.push(parseInt(r[e])*t);let n=0;for(let t=0;t<s;){let s=-a;for(let r=0;r<e;){const e=o<=0?h[n++]:o,l=a<=0?h[n++]:a;n===h.length&&(n=0),i.push({x:r,y:t,w:e,h:l}),o<0?r-=o:r+=e,l>s&&(s=l)}t+=s}}break;case"x":{const t=parseInt(r[1]),e=[];for(let s=2;s<r.length;s++)e.push(parseInt(r[s])*t);for(let t=0;t<e.length;){const s=e[t++],r=e[t++],o=e[t++],a=e[t++];i.push({x:s,y:r,w:o,h:a})}}}return i}static CutShapes(t){if(t.sprites)try{const e=this.DecodeShapes(t.sprites,t.width,t.height);if(e.length>0){const s=[];for(let r=0;r<e.length;r++)s.push(new i(t,e[r]));return s}}catch(t){}return[new s(t)]}}e.SpriteShape=i},366:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Sprites=void 0;const i=s(315),r=s(864);e.Sprites=class{static init(){this.spaceship=new i.Sprite(r.Images.spaceship),this.laser=new i.Sprite(r.Images.laser),this.laserAni=i.SpriteShape.CutShapes(r.Images.laserAnimation),this.redSpaceship=new i.Sprite(r.Images.redSpaceship),this.roids=i.SpriteShape.CutShapes(r.Images.roids),this.rocket=i.SpriteShape.CutShapes(r.Images.rocket)}}},369:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StarBackground=void 0;const i=s(553),r=s(864),o=s(538);class a{static getStarLayers(t){if(this.starLayers&&this.starLayers.length===t)return this.starLayers;const e=new i.RandomMersenne(12345),s=new Array(t);for(let t=0;t<s.length;t++){const i=new Uint32Array(256);for(let t=0;t<i.length;t++){const s=e.nextInt()>>8&4095,r=e.nextInt()>>8&4095;i[t]=s|r<<16}s[t]=i}return this.starLayers=s}static drawBackground(t,e=2,s=24,i=1,o=4){const a=t.ctx;a.save(),t.setSmooth(!0),a.fillStyle="#000",a.fillRect(0,0,t.w,t.h),a.fillStyle="#fff";const h=this.getStarLayers(s);for(let s=h.length-1;s>=0;s--){const n=s*e+(i+1),l=1/n,c=t.x-(t.w*n>>1)-125>>12,d=t.x+(t.w*n>>1)+4096+125>>12,u=t.y-(t.h*n>>1)-125>>12,m=t.y+(t.h*n>>1)+4096+125>>12;for(let e=u;e<m;e++)for(let i=c;i<d;i++){const n=(i<<12)-t.x,c=(e<<12)-t.y,d=h[s][1073741824+(i>>0)&15|(1073741824+(e>>0)&15)<<4];s>=o?a.fillRect(t.w/2+((65535&d)+n-12.5)*l,t.h/2+((d>>16)+c-12.5)*l,25*l,25*l):a.drawImage(r.Images.star,t.w/2+((65535&d)+n-125)*l,t.h/2+((d>>16)+c-125)*l,250*l,250*l)}}a.restore()}static drawBackgroundShift(t,e,s=10,i=2,o=24,a=1,h=4){const n=t.ctx;n.save(),t.setSmooth(!0),n.fillStyle="#000",n.fillRect(0,0,t.w,t.h),n.fillStyle="#fff";const l=this.getStarLayers(o);for(let c=l.length-1;c>=0;c--){const d=c>o/3;n.globalAlpha=d?1:Math.max(.5,1-s/10);const u=c*i+(a+1),m=1/u,p=t.x-(t.w*u>>1)-125>>12,y=t.x+(t.w*u>>1)+4096+125>>12,g=t.y-(t.h*u>>1)-125>>12,w=t.y+(t.h*u>>1)+4096+125>>12;for(let i=g;i<w;i++)for(let o=p;o<y;o++){const a=(o<<12)-t.x,u=(i<<12)-t.y,p=l[c][1073741824+(o>>0)&15|(1073741824+(i>>0)&15)<<4];d?n.fillRect(t.w/2+((65535&p)+a-12.5)*m,t.h/2+((p>>16)+u-12.5)*m,25*m,25*m):(n.translate(t.w/2+((65535&p)+a)*m,t.h/2+((p>>16)+u)*m),n.rotate(e),c>=h?n.fillRect(-12.5*m,m*s*-12.5,25*m,m*s*25):n.drawImage(r.Images.star,-125*m,m*Math.sqrt(s)*-125,250*m,m*Math.sqrt(s)*250),n.resetTransform())}}n.restore()}static drawAutoBackground(t,e){const s=Math.sqrt(e.mx*e.mx+e.my*e.my);if(s>4){const i=o.Vec.getHeadingAngle(e,o.Vec.getPredictedPos(e,1));a.drawBackgroundShift(t,i,s-3)}else a.drawBackground(t)}}e.StarBackground=a},295:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tools=void 0;const i=s(538);class r{static isInside(t,e){return t.x>=e.x&&t.x<e.x+e.w&&t.y>=e.y&&t.y<e.y+e.h}static rectFromLabel(t,e,s,i=0){return{x:t-i,y:e-s.actualBoundingBoxAscent-i,w:s.width+2*i,h:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+2*i}}static getWindowSize(){return{w:window.innerWidth,h:window.innerHeight}}static downloadText(t,e){var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="text",s.onload=()=>{e(s.status,s.response)},s.send()}static hashCode(t){let e=0;if(!t)return e;for(let s=0;s<t.length;s++)e=(e<<5)-e+t.charCodeAt(s),e|=0;return e}static rectIntersect(t,e){const s=Math.max(t.x,e.x),i=Math.min(t.x+t.w,e.x+e.w),r=Math.max(t.y,e.y),o=Math.min(t.y+t.h,e.y+e.h);return{x:s,y:r,w:Math.max(0,i-s),h:Math.max(0,o-r)}}static rectToString(t,e=2){return"{ x: "+t.x.toFixed(e)+", y: "+t.y.toFixed(e)+", w: "+t.w.toFixed(e)+", h: "+t.h.toFixed(e)+" }"}static checkCollide(t,e){const s=i.Vec.getDistance(t,e),o=t.sprites[t.spriteIndex],a=e.sprites[e.spriteIndex];if(!o.isReady(2)||!a.isReady(2))return-1;if(s>o.radius*t.scale+a.radius*e.scale)return 0;const h=o.radius*t.scale,n=a.radius*e.scale,l=r.rectIntersect({x:t.x-h,y:t.y-h,w:2*h,h:2*h},{x:e.x-n,y:e.y-n,w:2*n,h:2*n}),c={x:l.x-t.x-1>>0,y:l.y-t.y-1>>0,w:l.w+2>>0,h:l.h+2>>0},d={x:l.x-e.x-1>>0,y:l.y-e.y-1>>0,w:l.w+2>>0,h:l.h+2>>0},u=o.getCollisionMask(c,t.a,t.scale),m=a.getCollisionMask(d,e.a,e.scale);if(u.length!==m.length||u[0].length!==m[0].length)return console.log("invalid collision box"),-1;for(let t=0;t<u.length;t++){const e=u[t],s=m[t];for(let t=0;t<e.length;t++)if(e[t]+s[t]===4)return 2}return 1}}e.Tools=r},538:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Vec=void 0;const i=s(694);class r{static setPos(t,e){t.x=e.x,t.y=e.y,t.a=e.a}static getAdd(t,e){return{x:t.x+e.x,y:t.y+e.y}}static getSub(t,e){return{x:t.x-e.x,y:t.y-e.y}}static getLerp(t,e,s){return s<0&&(s=0),s>1&&(s=1),{x:t.x*(1-s)+e.x*s,y:t.y*(1-s)+e.y*s}}static getMag(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static getDistance(t,e){return this.getMag(this.getSub(t,e))}static getAngle(t){return Math.atan2(t.x,-t.y)}static getHeadingAngle(t,e){return this.getAngle(this.getSub(e,t))}static getRelativePos(t,e,s){return{x:t.x+Math.sin(e)*s,y:t.y-Math.cos(e)*s}}static moveRelative(t,e,s=0){s+=t.a,t.x+=Math.cos(s)*e.x-Math.sin(s)*e.y,t.y+=Math.sin(s)*e.x+Math.cos(s)*e.y}static getMove(t){return{x:t.mx,y:t.my}}static getSpeed(t){return this.getMag(r.getMove(t))}static getPredictedPos(t,e){return{x:t.x+t.mx*e,y:t.y+t.my*e,a:t.a+t.ma*e}}static updateSpeed(t,e,s=0){t.mx+=Math.sin(t.a+s)*e,t.my-=Math.cos(t.a+s)*e}static getSteerToAngle(t,e){e=(e+2e6*Math.PI)%(2*Math.PI);let s=(t.a+30*t.ma+2e6*Math.PI)%(2*Math.PI)-e;return s<0&&(s+=2*Math.PI),s=s>Math.PI?2*Math.PI-s:-s,Math.abs(s)>6e-4?s<0?i.Controls.Left:i.Controls.Right:i.Controls.None}}e.Vec=r},692:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Viewport=void 0,e.Viewport=class{constructor(t,e){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.retina=!0,this.x=0,this.y=0,this.w=0,this.h=0,this.resize(e)}resize(t){this.w=t.w,this.h=t.h,this.canvas.width=this.w,this.canvas.height=this.h,this.setSmooth(!1),this.ctx.imageSmoothingQuality="high"}setSmooth(t){this.ctx.imageSmoothingEnabled=t}setPos(t){this.x=t.x,this.y=t.y}}}},e={};function s(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={exports:{}};return t[i](o,o.exports,s),o.exports}(()=>{const t=s(511);window.onload=()=>{t.Game.init(),t.Game.run()}})()})();